<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Метод потенциалов — Практика</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100vh;
      background-color: #f5f5f5;
      font-family: 'Lora', serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .page-wrapper { width: 90%; max-width: 900px; text-align: center; }
    .page-title { font-size: 32px; font-weight: 600; margin-bottom: 24px; }
    .steps { display: inline-flex; gap: 12px; margin-bottom: 32px; }
    .step-button {
      padding: 8px 20px; font-size: 16px; font-weight: 600;
      background-color: #FACC15; color: #111; border: 2px solid #111;
      border-radius: 6px; cursor: pointer;
    }
    .input-container {
      border: 2px solid #000;
      border-radius: 16px;
      padding: 24px 32px;
      background-color: #fff;
      margin-bottom: 20px;
    }
    .fields-wrapper {
      display: flex; justify-content: space-between;
      gap: 16px; margin-bottom: 24px;
    }
    .field-box { flex: 1; display: flex; flex-direction: column; align-items: flex-start; }
    .field-box label { font-size: 16px; margin-bottom: 8px; }
    .field-box input {
      width: 100%; padding: 8px 12px; font-size: 16px;
      border: 1px solid #aaa; border-radius: 6px;
    }
    .matrix-table {
      border-collapse: collapse;
      margin: 24px auto;
    }
    .matrix-table td {
      width: 50px; height: 40px;
      border: 1px solid #999; background-color: #e8f6fa;
    }
    .matrix-table td input {
      width: 100%; height: 100%;
      border: none; background: transparent;
      text-align: center; font-size: 14px;
    }
    .button-row {
      display: flex; justify-content: center;
      gap: 16px; margin-top: 20px;
    }
    .action-button {
      padding: 12px 28px; font-size: 18px; font-weight: 600;
      background-color: #FACC15; color: #111; border: none;
      border-radius: 8px; cursor: pointer;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }
    .action-button:hover {
      background-color: #e5b00f; transform: translateY(-2px);
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <h1 class="page-title">Метод потенциалов <span style="font-size: 16px; color: #888;">Практика</span></h1>

    <div class="steps">
      <button class="step-button">Шаг 1</button>
      <button class="step-button">Шаг 2</button>
    </div>

    <!-- Шаг 1 -->
    <div class="input-container" id="step1">
      <div class="fields-wrapper">
        <div class="field-box">
          <label for="cols">Потребители (столбцы)</label>
          <input id="cols" type="number" min="1" />
        </div>
        <div class="field-box">
          <label for="rows">Поставщики (строки)</label>
          <input id="rows" type="number" min="1" />
        </div>
      </div>
      <button class="action-button" id="to-step2">Далее</button>
    </div>

    <!-- Шаг 2 -->
    <div class="input-container hidden" id="step2">
      <div class="label">Заполните матрицу тарифов</div>
      <table class="matrix-table" id="matrix-table"></table>
      <div class="button-row">
        <button class="action-button" id="back-to-step1">Назад</button>
        <button class="action-button" id="send-data">Решить</button>
      </div>
    </div>
  </div>

  <script>
    const toStep2Btn = document.getElementById('to-step2');
    const backBtn = document.getElementById('back-to-step1');
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const table = document.getElementById('matrix-table');
    const sendBtn = document.getElementById('send-data');

    let rows = 0, cols = 0;

    toStep2Btn.addEventListener('click', () => {
      rows = parseInt(document.getElementById('rows').value, 10);
      cols = parseInt(document.getElementById('cols').value, 10);

      if (!rows || !cols || rows < 1 || cols < 1) {
        alert("Введите корректные значения.");
        return;
      }

      step1.classList.add('hidden');
      step2.classList.remove('hidden');
      table.innerHTML = '';

      // строки тарифов + запасы
      for (let r = 0; r < rows; r++) {
        const tr = document.createElement('tr');
        for (let c = 0; c < cols; c++) {
          const td = document.createElement('td');
          td.innerHTML = `<input type="number" value="0">`;
          tr.appendChild(td);
        }
        const stockTd = document.createElement('td');
        stockTd.innerHTML = `<input type="number" value="0">`;
        tr.appendChild(stockTd);
        table.appendChild(tr);
      }

      // строка потребностей
      const demandRow = document.createElement('tr');
      for (let c = 0; c < cols; c++) {
        const td = document.createElement('td');
        td.innerHTML = `<input type="number" value="0">`;
        demandRow.appendChild(td);
      }
      demandRow.appendChild(document.createElement('td')); // пустая ячейка
      table.appendChild(demandRow);
    });

    backBtn.addEventListener('click', () => {
      table.innerHTML = '';
      step2.classList.add('hidden');
      step1.classList.remove('hidden');
    });

    sendBtn.addEventListener('click', () => {
      const matrix = [];
      const rowsHtml = table.querySelectorAll('tr');

      rowsHtml.forEach(tr => {
        const rowData = [];
        tr.querySelectorAll('input').forEach(input => {
          rowData.push(Number(input.value) || 0);
        });
        matrix.push(rowData);
      });

      const payload = {
        consumers: cols,
        suppliers: rows,
        matrix: matrix
      };

      fetch('/api/solve/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => {
        console.log('Ответ от сервера:', data);
        alert('Ответ получен. Смотри консоль.');
      })
      .catch(err => {
        console.error('Ошибка запроса:', err);
        alert('Ошибка при отправке.');
      });
    });
  </script>
</body>
</html>
